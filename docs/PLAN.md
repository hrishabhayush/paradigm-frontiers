### zkAuction Wallet — Implementation Plan and TODOs

This plan turns the demo scope in `project.txt` into a concrete, time-boxed execution path for a 2-minute demo. It prioritizes a happy-path end-to-end flow, with clean boundaries and testable interfaces.

## Tech Choices (demo-friendly)
- ZK circuit: Circom + Groth16 via `snarkjs` (fast setup, broad docs)
- Verifier: Solidity verifier generated by `snarkjs zkey export verifer`
- Wallet plugin: Solidity (Porto plugin template fork)
- Backend spending tracker (mock): Node.js (TypeScript, no DB; reads static JSON)
- Relayer (mock auction): Node.js (TypeScript, minimal HTTP server)
- Frontend: React (Next.js or Vite + React) with Porto SDK

## Milestones
1) ZK Circuit (Circom/Groth16)
2) Backend Spending Tracker (mock) + Prover wrapper
3) Contracts: Verifier + Porto Wallet Plugin
4) Mock Auction Relayer
5) Frontend App (React + Porto SDK)
6) Integration Test (happy path)
7) Demo Polish (diagram, README, slide bullets)

## Cross-Cutting Requirements
- All components log key checkpoints to stdout (for demo narration)
- Deterministic mock data checked into repo under `mock/`
- One-command run per component (later), documented in README
- Revert reasons standardized and human-readable

## Detailed TODOs

### 1) ZK Spending Limit Circuit
- [x] ~~Circom circuit `spend_limit.circom`~~
  - Private inputs: `total_spent`
  - Public inputs: `week_start`, `hash_of_tx_list`
  - Constraint: `total_spent < 100`
- [x] ~~Input witness builder (via `snarkjs` CLI)~~
- [x] ~~Trusted setup (Powers of Tau) for demo (local, scripted)~~
- [x] ~~Proving key, verification key, example proof generation~~
- [x] ~~Export Solidity verifier~~
- [x] ~~CLI script: verify proof locally with `snarkjs groth16 verify`~~

Acceptance: Given the example inputs in `docs/PROOF_INPUT_EXAMPLE.json`, a valid proof is produced and verified locally.

### 2) Backend Spending Tracker (Mock)
- [x] Static JSON `mock/txs.json` matching schema in `project.txt`
- [ ] Node script computes weekly spend and outputs prover inputs
- [ ] Script invokes prover, returns `{ proof, publicSignals }`
- [ ] Optional: CLI prints “Proof: User spent $420 this week”

Acceptance: Running the script prints the computed total and stores proof + public signals to `out/`.

### 3) Porto Wallet Plugin
- [ ] Fork Porto plugin template
- [ ] Add `verifyProof(bytes proof, uint256[] publicInputs)` using generated verifier
- [ ] Add `requireRelayer(address expected)` guard on execution entrypoint
- [ ] Config storage: `spendLimit`, `relayerAddress`, `recoveryAddress`
- [ ] Unit tests: valid proof passes; invalid proof reverts; wrong relayer reverts

Acceptance: All unit tests pass locally; gas within demo-tolerable bounds.

### 4) Auction-Based Relayer (Mock)
- [ ] HTTP server POST `/bundle` accepts `{ tx, proof, publicInputs }`
- [ ] Simulate 2+ searchers placing random bids (stdout logs)
- [ ] Choose winner; “submit” tx to chain (mock Provider or testnet)
- [ ] Log: “Relayer received tx”, bids, winner, submission
- [ ] GET `/health` returns `ok`

Acceptance: cURL to `/bundle` shows auction logs and a submission result.

### 5) Frontend App (React + Porto SDK)
- [ ] Connect wallet (Porto SDK)
- [ ] Send USDC form: amount + recipient
- [ ] Button: “Generate ZK Proof” (calls backend mock)
- [ ] Button: “Submit Privately” (POST to relayer)
- [ ] On success: show “Tx Confirmed” and optional decoded ZK inputs

Acceptance: In the browser, the happy path produces visible confirmation and proof summary.

### 6) Integration Testing
- [ ] Script orchestrates: generate proof → relay → plugin verifies
- [ ] Logs at each step: proof valid, auction complete, plugin accepted
- [ ] Negative test (optional): overspend or invalid proof → revert

Acceptance: One command runs end-to-end and prints all checkpoints.

### 7) Demo Polish
- [ ] Architecture diagram (`docs/ARCHITECTURE.md`)
- [ ] README with one-command-per-service instructions
- [ ] 3–4 slide bullets embedded in README or separate PDF

## Risk/Decision Notes
- Circom/Groth16 chosen for time-to-demo; Noir/Plonk can be swapped later with similar interfaces
- Mock data and mocked chain submission reduce integration risk under hackathon timelines

## Related Docs
- Architecture: `docs/ARCHITECTURE.md`
- ZK Circuit Spec: `docs/ZK_CIRCUIT_SPEC.md`
- Relayer API: `docs/RELAYER_OPENAPI.yaml`
- Plugin Spec: `docs/PORTO_PLUGIN_SPEC.md`
- Frontend Spec: `docs/FRONTEND_SPEC.md`

## External References
- Circom docs: `https://docs.circom.io`
- snarkjs: `https://github.com/iden3/snarkjs`
- circomlib: `https://github.com/iden3/circomlib`
- Noir (alt): `https://docs.noir-lang.org`
- Flashbots Protect: `https://docs.flashbots.net/flashbots-protect/overview`
- Porto SDK: `https://porto.sh`

